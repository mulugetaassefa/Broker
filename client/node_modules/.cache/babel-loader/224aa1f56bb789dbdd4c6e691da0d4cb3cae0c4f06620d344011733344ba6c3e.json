{"ast":null,"code":"var _jsxFileName = \"D:\\\\project\\\\react\\\\project\\\\client\\\\src\\\\pages\\\\dashboard\\\\Messages.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { useSocket } from '../../contexts/SocketContext';\nimport api from '../../services/api';\nimport { FiSend, FiPaperclip, FiImage, FiFile, FiSmile, FiChevronDown, FiMessageSquare } from 'react-icons/fi';\nimport { format } from 'date-fns';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Messages = () => {\n  _s();\n  var _selectedConversation;\n  const {\n    user\n  } = useAuth();\n  const {\n    socket,\n    joinConversation,\n    leaveConversation,\n    sendMessage\n  } = useSocket();\n  const [message, setMessage] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [conversations, setConversations] = useState([]);\n  const [selectedConversation, setSelectedConversation] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [isTyping, setIsTyping] = useState(false);\n  const messagesEndRef = useRef(null);\n  const fileInputRef = useRef(null);\n\n  // Fetch conversations on component mount\n  useEffect(() => {\n    const fetchConversations = async () => {\n      try {\n        setLoading(true);\n        const {\n          data\n        } = await api.messages.getConversations();\n        setConversations(data);\n        if (data.length > 0 && !selectedConversation) {\n          setSelectedConversation(data[0]);\n        }\n      } catch (err) {\n        setError('Failed to load conversations');\n        console.error('Error fetching conversations:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchConversations();\n  }, []);\n\n  // Fetch messages when selected conversation changes\n  useEffect(() => {\n    if (selectedConversation) {\n      const fetchMessages = async () => {\n        try {\n          setLoading(true);\n          const {\n            data\n          } = await api.messages.getMessages(selectedConversation._id);\n          setMessages(data);\n          scrollToBottom();\n        } catch (err) {\n          setError('Failed to load messages');\n          console.error('Error fetching messages:', err);\n        } finally {\n          setLoading(false);\n        }\n      };\n      fetchMessages();\n    }\n  }, [selectedConversation === null || selectedConversation === void 0 ? void 0 : selectedConversation._id]);\n\n  // Handle new messages from WebSocket\n  useEffect(() => {\n    if (!socket) return;\n    const handleNewMessage = newMessage => {\n      setMessages(prev => {\n        // Check if this message already exists in the state\n        const messageExists = prev.some(msg => msg._id === newMessage._id || msg.content === newMessage.content && Math.abs(new Date(msg.createdAt) - new Date(newMessage.createdAt)) < 1000);\n        if (messageExists) {\n          // If it's an optimistic message being confirmed, replace it with the real one\n          if (newMessage.isOptimistic) {\n            return prev.map(msg => msg.isOptimistic && msg.content === newMessage.content ? newMessage : msg);\n          }\n          return prev; // Skip adding duplicate\n        }\n\n        // Remove any optimistic message with the same content\n        const filtered = prev.filter(msg => !(msg.isOptimistic && msg.content === newMessage.content));\n        return [...filtered, newMessage];\n      });\n      if (newMessage.sender._id !== user.id) {\n        markAsRead(newMessage._id);\n      }\n      scrollToBottom();\n    };\n    socket.on('new_message', handleNewMessage);\n    return () => {\n      socket.off('new_message', handleNewMessage);\n    };\n  }, [socket, user.id]);\n\n  // Join conversation room when selected\n  useEffect(() => {\n    if (selectedConversation !== null && selectedConversation !== void 0 && selectedConversation._id && socket) {\n      joinConversation(selectedConversation._id);\n      markMessagesAsRead();\n      return () => {\n        leaveConversation(selectedConversation._id);\n      };\n    }\n  }, [selectedConversation === null || selectedConversation === void 0 ? void 0 : selectedConversation._id, socket, joinConversation, leaveConversation]);\n  const scrollToBottom = useCallback(() => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  }, []);\n  const handleSendMessage = async e => {\n    e.preventDefault();\n    if (!message.trim() || !selectedConversation) return;\n    let optimisticMessage;\n    try {\n      const newMessage = {\n        content: message,\n        conversationId: selectedConversation._id,\n        receiver: selectedConversation.participant._id\n      };\n\n      // Optimistic UI update\n      optimisticMessage = {\n        ...newMessage,\n        _id: Date.now().toString(),\n        sender: {\n          _id: user.id,\n          firstName: user.firstName,\n          lastName: user.lastName\n        },\n        receiver: selectedConversation.participant._id,\n        createdAt: new Date().toISOString(),\n        isRead: false,\n        isOptimistic: true\n      };\n      setMessages(prev => [...prev, optimisticMessage]);\n      setMessage('');\n      scrollToBottom();\n\n      // Try to send via WebSocket first\n      try {\n        await sendMessage(newMessage);\n      } catch (wsError) {\n        console.warn('WebSocket send failed, falling back to HTTP:', wsError);\n        // Fallback to HTTP if WebSocket fails\n        await api.messages.sendMessage(newMessage);\n      }\n\n      // Refresh conversations to update last message\n      const {\n        data\n      } = await api.messages.getConversations();\n      setConversations(data);\n    } catch (err) {\n      console.error('Error sending message:', err);\n      setError('Failed to send message');\n      // Remove the optimistic message if sending failed\n      if (optimisticMessage) {\n        setMessages(prev => prev.filter(m => !m.isOptimistic || m._id !== optimisticMessage._id));\n      }\n    }\n  };\n  const markAsRead = async messageId => {\n    try {\n      await api.messages.markAsRead(messageId);\n    } catch (error) {\n      console.error('Error marking message as read:', error);\n    }\n  };\n  const markMessagesAsRead = async () => {\n    const unreadMessages = messages.filter(msg => !msg.isRead && msg.receiver === user.id);\n    if (unreadMessages.length > 0) {\n      try {\n        await Promise.all(unreadMessages.map(msg => markAsRead(msg._id)));\n        // Update local state to reflect read status\n        setMessages(prev => prev.map(msg => ({\n          ...msg,\n          isRead: true\n        })));\n      } catch (error) {\n        console.error('Error marking messages as read:', error);\n      }\n    }\n  };\n  const handleFileUpload = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    // Handle file upload logic here\n    console.log('File selected:', file);\n    // You'll need to implement the actual file upload logic\n  };\n  const handleKeyDown = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      if (message.trim()) {\n        handleSendMessage(e);\n      }\n    }\n  };\n  const renderMessage = msg => {\n    var _msg$sender$firstName;\n    const isCurrentUser = msg.sender._id === user.id;\n    const messageDate = new Date(msg.createdAt);\n    const formattedTime = format(messageDate, 'h:mm a');\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `flex ${isCurrentUser ? 'justify-end' : 'justify-start'} mb-4`,\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `flex max-w-xs lg:max-w-md ${isCurrentUser ? 'flex-row-reverse' : ''}`,\n        children: [!isCurrentUser && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-8 h-8 rounded-full bg-gray-300 flex-shrink-0 flex items-center justify-center mr-2\",\n          children: (_msg$sender$firstName = msg.sender.firstName) === null || _msg$sender$firstName === void 0 ? void 0 : _msg$sender$firstName.charAt(0).toUpperCase()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [!isCurrentUser && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-xs text-gray-500 mb-1\",\n            children: [msg.sender.firstName, \" \", msg.sender.lastName]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `px-4 py-2 rounded-lg ${isCurrentUser ? 'bg-blue-500 text-white rounded-tr-none' : 'bg-gray-200 text-gray-800 rounded-tl-none'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"break-words\",\n              children: msg.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex items-center justify-end mt-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-xs opacity-75\",\n                children: formattedTime\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 253,\n                columnNumber: 17\n              }, this), isCurrentUser && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"ml-1\",\n                children: msg.isRead ? '✓✓' : '✓'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 257,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 252,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this)\n    }, msg._id, false, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }, this);\n  };\n  if (loading && !selectedConversation) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center justify-center h-screen\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex h-screen bg-gray-100\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"w-full md:w-1/3 lg:w-1/4 border-r border-gray-200 bg-white flex flex-col\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"p-4 border-b border-gray-200\",\n        children: /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-semibold\",\n          children: \"Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 overflow-y-auto\",\n        children: conversations.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 text-center text-gray-500\",\n          children: \"No conversations yet\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 13\n        }, this) : conversations.map(conv => {\n          var _conv$participant$fir, _conv$lastMessage, _conv$lastMessage2;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 flex items-center ${(selectedConversation === null || selectedConversation === void 0 ? void 0 : selectedConversation._id) === conv._id ? 'bg-blue-50' : ''}`,\n            onClick: () => setSelectedConversation(conv),\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-12 h-12 rounded-full bg-gray-300 flex-shrink-0 flex items-center justify-center mr-3\",\n              children: (_conv$participant$fir = conv.participant.firstName) === null || _conv$participant$fir === void 0 ? void 0 : _conv$participant$fir.charAt(0).toUpperCase()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 298,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex-1 min-w-0\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between items-center\",\n                children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                  className: \"font-medium truncate\",\n                  children: [conv.participant.firstName, \" \", conv.participant.lastName]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 303,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"text-xs text-gray-500\",\n                  children: (_conv$lastMessage = conv.lastMessage) !== null && _conv$lastMessage !== void 0 && _conv$lastMessage.createdAt ? format(new Date(conv.lastMessage.createdAt), 'MMM d') : ''\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 306,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 302,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex justify-between items-center\",\n                children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-sm text-gray-500 truncate\",\n                  children: ((_conv$lastMessage2 = conv.lastMessage) === null || _conv$lastMessage2 === void 0 ? void 0 : _conv$lastMessage2.content) || 'No messages yet'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 313,\n                  columnNumber: 21\n                }, this), conv.unreadCount > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"bg-blue-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center ml-2\",\n                  children: conv.unreadCount\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 317,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 312,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 17\n            }, this)]\n          }, conv._id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 280,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"hidden md:flex flex-col flex-1\",\n      children: selectedConversation ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 border-b border-gray-200 bg-white flex items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"w-10 h-10 rounded-full bg-gray-300 flex-shrink-0 flex items-center justify-center mr-3\",\n            children: (_selectedConversation = selectedConversation.participant.firstName) === null || _selectedConversation === void 0 ? void 0 : _selectedConversation.charAt(0).toUpperCase()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"font-medium\",\n              children: [selectedConversation.participant.firstName, ' ', selectedConversation.participant.lastName]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 339,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-xs text-gray-500\",\n              children: isTyping ? 'typing...' : 'Online'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 343,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 334,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex-1 overflow-y-auto p-4 bg-gray-50\",\n          onClick: markMessagesAsRead,\n          children: messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"h-full flex items-center justify-center text-gray-500\",\n            children: \"No messages yet. Start the conversation!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 17\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-4\",\n            children: [messages.map(renderMessage), /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: messagesEndRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 361,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 359,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"p-4 border-t border-gray-200 bg-white\",\n          children: /*#__PURE__*/_jsxDEV(\"form\", {\n            onSubmit: handleSendMessage,\n            className: \"flex items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative flex-1\",\n              children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"text\",\n                value: message,\n                onChange: e => setMessage(e.target.value),\n                onKeyDown: handleKeyDown,\n                placeholder: \"Type a message...\",\n                className: \"w-full border border-gray-300 rounded-full pl-4 pr-12 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 370,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                type: \"button\",\n                className: \"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\",\n                onClick: () => {\n                  var _fileInputRef$current;\n                  return (_fileInputRef$current = fileInputRef.current) === null || _fileInputRef$current === void 0 ? void 0 : _fileInputRef$current.click();\n                },\n                children: [/*#__PURE__*/_jsxDEV(FiPaperclip, {\n                  className: \"h-5 w-5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 383,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"file\",\n                  ref: fileInputRef,\n                  className: \"hidden\",\n                  onChange: handleFileUpload\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 384,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 378,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 369,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              disabled: !message.trim(),\n              className: `ml-2 p-2 rounded-full ${message.trim() ? 'bg-blue-500 text-white hover:bg-blue-600' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`,\n              children: /*#__PURE__*/_jsxDEV(FiSend, {\n                className: \"h-5 w-5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 401,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 392,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 368,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1 flex items-center justify-center bg-gray-50\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-center p-6 max-w-md\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4\",\n            children: /*#__PURE__*/_jsxDEV(FiMessageSquare, {\n              className: \"h-8 w-8 text-blue-600\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 410,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"text-lg font-medium text-gray-900 mb-2\",\n            children: \"No conversation selected\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-gray-500\",\n            children: \"Select a conversation or start a new one to begin messaging.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 278,\n    columnNumber: 5\n  }, this);\n};\n_s(Messages, \"4dIaT8m/WJh6JRhTVKX0vjKJolg=\", false, function () {\n  return [useAuth, useSocket];\n});\n_c = Messages;\nexport default Messages;\nvar _c;\n$RefreshReg$(_c, \"Messages\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useAuth","useSocket","api","FiSend","FiPaperclip","FiImage","FiFile","FiSmile","FiChevronDown","FiMessageSquare","format","jsxDEV","_jsxDEV","Fragment","_Fragment","Messages","_s","_selectedConversation","user","socket","joinConversation","leaveConversation","sendMessage","message","setMessage","messages","setMessages","conversations","setConversations","selectedConversation","setSelectedConversation","loading","setLoading","error","setError","isTyping","setIsTyping","messagesEndRef","fileInputRef","fetchConversations","data","getConversations","length","err","console","fetchMessages","getMessages","_id","scrollToBottom","handleNewMessage","newMessage","prev","messageExists","some","msg","content","Math","abs","Date","createdAt","isOptimistic","map","filtered","filter","sender","id","markAsRead","on","off","markMessagesAsRead","_messagesEndRef$curre","current","scrollIntoView","behavior","handleSendMessage","e","preventDefault","trim","optimisticMessage","conversationId","receiver","participant","now","toString","firstName","lastName","toISOString","isRead","wsError","warn","m","messageId","unreadMessages","Promise","all","handleFileUpload","file","target","files","log","handleKeyDown","key","shiftKey","renderMessage","_msg$sender$firstName","isCurrentUser","messageDate","formattedTime","className","children","charAt","toUpperCase","fileName","_jsxFileName","lineNumber","columnNumber","conv","_conv$participant$fir","_conv$lastMessage","_conv$lastMessage2","onClick","lastMessage","unreadCount","ref","onSubmit","type","value","onChange","onKeyDown","placeholder","_fileInputRef$current","click","disabled","_c","$RefreshReg$"],"sources":["D:/project/react/project/client/src/pages/dashboard/Messages.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { useSocket } from '../../contexts/SocketContext';\r\nimport api from '../../services/api';\r\nimport { FiSend, FiPaperclip, FiImage, FiFile, FiSmile, FiChevronDown, FiMessageSquare } from 'react-icons/fi';\r\nimport { format } from 'date-fns';\r\n\r\nconst Messages = () => {\r\n  const { user } = useAuth();\r\n  const { socket, joinConversation, leaveConversation, sendMessage } = useSocket();\r\n  const [message, setMessage] = useState('');\r\n  const [messages, setMessages] = useState([]);\r\n  const [conversations, setConversations] = useState([]);\r\n  const [selectedConversation, setSelectedConversation] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [isTyping, setIsTyping] = useState(false);\r\n  const messagesEndRef = useRef(null);\r\n  const fileInputRef = useRef(null);\r\n\r\n  // Fetch conversations on component mount\r\n  useEffect(() => {\r\n    const fetchConversations = async () => {\r\n      try {\r\n        setLoading(true);\r\n        const { data } = await api.messages.getConversations();\r\n        setConversations(data);\r\n        if (data.length > 0 && !selectedConversation) {\r\n          setSelectedConversation(data[0]);\r\n        }\r\n      } catch (err) {\r\n        setError('Failed to load conversations');\r\n        console.error('Error fetching conversations:', err);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchConversations();\r\n  }, []);\r\n\r\n  // Fetch messages when selected conversation changes\r\n  useEffect(() => {\r\n    if (selectedConversation) {\r\n      const fetchMessages = async () => {\r\n        try {\r\n          setLoading(true);\r\n          const { data } = await api.messages.getMessages(selectedConversation._id);\r\n          setMessages(data);\r\n          scrollToBottom();\r\n        } catch (err) {\r\n          setError('Failed to load messages');\r\n          console.error('Error fetching messages:', err);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      };\r\n\r\n      fetchMessages();\r\n    }\r\n  }, [selectedConversation?._id]);\r\n\r\n  // Handle new messages from WebSocket\r\n  useEffect(() => {\r\n    if (!socket) return;\r\n\r\n    const handleNewMessage = (newMessage) => {\r\n      setMessages(prev => {\r\n        // Check if this message already exists in the state\r\n        const messageExists = prev.some(msg => \r\n          (msg._id === newMessage._id) || \r\n          (msg.content === newMessage.content && \r\n           Math.abs(new Date(msg.createdAt) - new Date(newMessage.createdAt)) < 1000)\r\n        );\r\n        \r\n        if (messageExists) {\r\n          // If it's an optimistic message being confirmed, replace it with the real one\r\n          if (newMessage.isOptimistic) {\r\n            return prev.map(msg => \r\n              (msg.isOptimistic && msg.content === newMessage.content) ? newMessage : msg\r\n            );\r\n          }\r\n          return prev; // Skip adding duplicate\r\n        }\r\n        \r\n        // Remove any optimistic message with the same content\r\n        const filtered = prev.filter(msg => \r\n          !(msg.isOptimistic && msg.content === newMessage.content)\r\n        );\r\n        \r\n        return [...filtered, newMessage];\r\n      });\r\n      \r\n      if (newMessage.sender._id !== user.id) {\r\n        markAsRead(newMessage._id);\r\n      }\r\n      scrollToBottom();\r\n    };\r\n\r\n    socket.on('new_message', handleNewMessage);\r\n    return () => {\r\n      socket.off('new_message', handleNewMessage);\r\n    };\r\n  }, [socket, user.id]);\r\n\r\n  // Join conversation room when selected\r\n  useEffect(() => {\r\n    if (selectedConversation?._id && socket) {\r\n      joinConversation(selectedConversation._id);\r\n      markMessagesAsRead();\r\n      \r\n      return () => {\r\n        leaveConversation(selectedConversation._id);\r\n      };\r\n    }\r\n  }, [selectedConversation?._id, socket, joinConversation, leaveConversation]);\r\n\r\n  const scrollToBottom = useCallback(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, []);\r\n\r\n  const handleSendMessage = async (e) => {\r\n    e.preventDefault();\r\n    if (!message.trim() || !selectedConversation) return;\r\n\r\n    let optimisticMessage;\r\n    \r\n    try {\r\n      const newMessage = {\r\n        content: message,\r\n        conversationId: selectedConversation._id,\r\n        receiver: selectedConversation.participant._id\r\n      };\r\n\r\n      // Optimistic UI update\r\n      optimisticMessage = {\r\n        ...newMessage,\r\n        _id: Date.now().toString(),\r\n        sender: { _id: user.id, firstName: user.firstName, lastName: user.lastName },\r\n        receiver: selectedConversation.participant._id,\r\n        createdAt: new Date().toISOString(),\r\n        isRead: false,\r\n        isOptimistic: true\r\n      };\r\n      \r\n      setMessages(prev => [...prev, optimisticMessage]);\r\n      setMessage('');\r\n      scrollToBottom();\r\n\r\n      // Try to send via WebSocket first\r\n      try {\r\n        await sendMessage(newMessage);\r\n      } catch (wsError) {\r\n        console.warn('WebSocket send failed, falling back to HTTP:', wsError);\r\n        // Fallback to HTTP if WebSocket fails\r\n        await api.messages.sendMessage(newMessage);\r\n      }\r\n      \r\n      // Refresh conversations to update last message\r\n      const { data } = await api.messages.getConversations();\r\n      setConversations(data);\r\n      \r\n    } catch (err) {\r\n      console.error('Error sending message:', err);\r\n      setError('Failed to send message');\r\n      // Remove the optimistic message if sending failed\r\n      if (optimisticMessage) {\r\n        setMessages(prev => prev.filter(m => !m.isOptimistic || m._id !== optimisticMessage._id));\r\n      }\r\n    }\r\n  };\r\n\r\n  const markAsRead = async (messageId) => {\r\n    try {\r\n      await api.messages.markAsRead(messageId);\r\n    } catch (error) {\r\n      console.error('Error marking message as read:', error);\r\n    }\r\n  };\r\n\r\n  const markMessagesAsRead = async () => {\r\n    const unreadMessages = messages.filter(\r\n      msg => !msg.isRead && msg.receiver === user.id\r\n    );\r\n    \r\n    if (unreadMessages.length > 0) {\r\n      try {\r\n        await Promise.all(\r\n          unreadMessages.map(msg => markAsRead(msg._id))\r\n        );\r\n        // Update local state to reflect read status\r\n        setMessages(prev => \r\n          prev.map(msg => ({\r\n            ...msg,\r\n            isRead: true\r\n          }))\r\n        );\r\n      } catch (error) {\r\n        console.error('Error marking messages as read:', error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleFileUpload = (e) => {\r\n    const file = e.target.files[0];\r\n    if (!file) return;\r\n\r\n    // Handle file upload logic here\r\n    console.log('File selected:', file);\r\n    // You'll need to implement the actual file upload logic\r\n  };\r\n\r\n  const handleKeyDown = (e) => {\r\n    if (e.key === 'Enter' && !e.shiftKey) {\r\n      e.preventDefault();\r\n      if (message.trim()) {\r\n        handleSendMessage(e);\r\n      }\r\n    }\r\n  };\r\n\r\n  const renderMessage = (msg) => {\r\n    const isCurrentUser = msg.sender._id === user.id;\r\n    const messageDate = new Date(msg.createdAt);\r\n    const formattedTime = format(messageDate, 'h:mm a');\r\n\r\n    return (\r\n      <div \r\n        key={msg._id} \r\n        className={`flex ${isCurrentUser ? 'justify-end' : 'justify-start'} mb-4`}\r\n      >\r\n        <div className={`flex max-w-xs lg:max-w-md ${isCurrentUser ? 'flex-row-reverse' : ''}`}>\r\n          {!isCurrentUser && (\r\n            <div className=\"w-8 h-8 rounded-full bg-gray-300 flex-shrink-0 flex items-center justify-center mr-2\">\r\n              {msg.sender.firstName?.charAt(0).toUpperCase()}\r\n            </div>\r\n          )}\r\n          <div>\r\n            {!isCurrentUser && (\r\n              <div className=\"text-xs text-gray-500 mb-1\">\r\n                {msg.sender.firstName} {msg.sender.lastName}\r\n              </div>\r\n            )}\r\n            <div\r\n              className={`px-4 py-2 rounded-lg ${\r\n                isCurrentUser\r\n                  ? 'bg-blue-500 text-white rounded-tr-none'\r\n                  : 'bg-gray-200 text-gray-800 rounded-tl-none'\r\n              }`}\r\n            >\r\n              <p className=\"break-words\">{msg.content}</p>\r\n              <div className=\"flex items-center justify-end mt-1\">\r\n                <span className=\"text-xs opacity-75\">\r\n                  {formattedTime}\r\n                </span>\r\n                {isCurrentUser && (\r\n                  <span className=\"ml-1\">\r\n                    {msg.isRead ? '✓✓' : '✓'}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading && !selectedConversation) {\r\n    return (\r\n      <div className=\"flex items-center justify-center h-screen\">\r\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500\"></div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex h-screen bg-gray-100\">\r\n      {/* Sidebar with conversations */}\r\n      <div className=\"w-full md:w-1/3 lg:w-1/4 border-r border-gray-200 bg-white flex flex-col\">\r\n        <div className=\"p-4 border-b border-gray-200\">\r\n          <h2 className=\"text-xl font-semibold\">Messages</h2>\r\n        </div>\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          {conversations.length === 0 ? (\r\n            <div className=\"p-4 text-center text-gray-500\">\r\n              No conversations yet\r\n            </div>\r\n          ) : (\r\n            conversations.map((conv) => (\r\n              <div\r\n                key={conv._id}\r\n                className={`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 flex items-center ${\r\n                  selectedConversation?._id === conv._id ? 'bg-blue-50' : ''\r\n                }`}\r\n                onClick={() => setSelectedConversation(conv)}\r\n              >\r\n                <div className=\"w-12 h-12 rounded-full bg-gray-300 flex-shrink-0 flex items-center justify-center mr-3\">\r\n                  {conv.participant.firstName?.charAt(0).toUpperCase()}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <h3 className=\"font-medium truncate\">\r\n                      {conv.participant.firstName} {conv.participant.lastName}\r\n                    </h3>\r\n                    <span className=\"text-xs text-gray-500\">\r\n                      {conv.lastMessage?.createdAt \r\n                        ? format(new Date(conv.lastMessage.createdAt), 'MMM d')\r\n                        : ''}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"flex justify-between items-center\">\r\n                    <p className=\"text-sm text-gray-500 truncate\">\r\n                      {conv.lastMessage?.content || 'No messages yet'}\r\n                    </p>\r\n                    {conv.unreadCount > 0 && (\r\n                      <span className=\"bg-blue-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center ml-2\">\r\n                        {conv.unreadCount}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Chat area */}\r\n      <div className=\"hidden md:flex flex-col flex-1\">\r\n        {selectedConversation ? (\r\n          <>\r\n            {/* Chat header */}\r\n            <div className=\"p-4 border-b border-gray-200 bg-white flex items-center\">\r\n              <div className=\"w-10 h-10 rounded-full bg-gray-300 flex-shrink-0 flex items-center justify-center mr-3\">\r\n                {selectedConversation.participant.firstName?.charAt(0).toUpperCase()}\r\n              </div>\r\n              <div>\r\n                <h2 className=\"font-medium\">\r\n                  {selectedConversation.participant.firstName}{' '}\r\n                  {selectedConversation.participant.lastName}\r\n                </h2>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  {isTyping ? 'typing...' : 'Online'}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Messages */}\r\n            <div \r\n              className=\"flex-1 overflow-y-auto p-4 bg-gray-50\"\r\n              onClick={markMessagesAsRead}\r\n            >\r\n              {messages.length === 0 ? (\r\n                <div className=\"h-full flex items-center justify-center text-gray-500\">\r\n                  No messages yet. Start the conversation!\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {messages.map(renderMessage)}\r\n                  <div ref={messagesEndRef} />\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Message input */}\r\n            <div className=\"p-4 border-t border-gray-200 bg-white\">\r\n              <form onSubmit={handleSendMessage} className=\"flex items-center\">\r\n                <div className=\"relative flex-1\">\r\n                  <input\r\n                    type=\"text\"\r\n                    value={message}\r\n                    onChange={(e) => setMessage(e.target.value)}\r\n                    onKeyDown={handleKeyDown}\r\n                    placeholder=\"Type a message...\"\r\n                    className=\"w-full border border-gray-300 rounded-full pl-4 pr-12 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600\"\r\n                    onClick={() => fileInputRef.current?.click()}\r\n                  >\r\n                    <FiPaperclip className=\"h-5 w-5\" />\r\n                    <input\r\n                      type=\"file\"\r\n                      ref={fileInputRef}\r\n                      className=\"hidden\"\r\n                      onChange={handleFileUpload}\r\n                    />\r\n                  </button>\r\n                </div>\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={!message.trim()}\r\n                  className={`ml-2 p-2 rounded-full ${\r\n                    message.trim() \r\n                      ? 'bg-blue-500 text-white hover:bg-blue-600' \r\n                      : 'bg-gray-200 text-gray-400 cursor-not-allowed'\r\n                  }`}\r\n                >\r\n                  <FiSend className=\"h-5 w-5\" />\r\n                </button>\r\n              </form>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <div className=\"flex-1 flex items-center justify-center bg-gray-50\">\r\n            <div className=\"text-center p-6 max-w-md\">\r\n              <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 mb-4\">\r\n                <FiMessageSquare className=\"h-8 w-8 text-blue-600\" />\r\n              </div>\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No conversation selected</h3>\r\n              <p className=\"text-gray-500\">\r\n                Select a conversation or start a new one to begin messaging.\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Messages;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}